<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js coal">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>carapace</title>
        
        <meta name="robots" content="noindex" />
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="favicon.svg">
        
        
        <link rel="shortcut icon" href="favicon.png">
        
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        
        <link rel="stylesheet" href="css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "coal";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('coal')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="carapace.html"><strong aria-hidden="true">1.</strong> carapace</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="carapace/gen.html"><strong aria-hidden="true">1.1.</strong> Gen</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="carapace/gen/hiddenSubcommand.html"><strong aria-hidden="true">1.1.1.</strong> Hidden Subcommand</a></li><li class="chapter-item expanded "><a href="carapace/gen/positionalCompletion.html"><strong aria-hidden="true">1.1.2.</strong> PositionalCompletion</a></li><li class="chapter-item expanded "><a href="carapace/gen/flagCompletion.html"><strong aria-hidden="true">1.1.3.</strong> FlagCompletion</a></li></ol></li><li class="chapter-item expanded "><a href="carapace/action.html"><strong aria-hidden="true">1.2.</strong> Action</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="carapace/action/actionValues.html"><strong aria-hidden="true">1.2.1.</strong> ActionValues</a></li><li class="chapter-item expanded "><a href="carapace/action/actionValuesDescribed.html"><strong aria-hidden="true">1.2.2.</strong> ActionValuesDescribed</a></li><li class="chapter-item expanded "><a href="carapace/action/actionFiles.html"><strong aria-hidden="true">1.2.3.</strong> ActionFiles</a></li><li class="chapter-item expanded "><a href="carapace/action/actionDirectories.html"><strong aria-hidden="true">1.2.4.</strong> ActionDirectories</a></li><li class="chapter-item expanded "><a href="carapace/action/actionMessage.html"><strong aria-hidden="true">1.2.5.</strong> ActionMessage</a></li><li class="chapter-item expanded "><a href="carapace/action/actionCallback.html"><strong aria-hidden="true">1.2.6.</strong> ActionCallback</a></li><li class="chapter-item expanded "><a href="carapace/action/actionMultiParts.html"><strong aria-hidden="true">1.2.7.</strong> ActionMultiParts</a></li><li class="chapter-item expanded "><a href="carapace/action/actionExecCommand.html"><strong aria-hidden="true">1.2.8.</strong> ActionExecCommand</a></li><li class="chapter-item expanded "><a href="carapace/action/custom.html"><strong aria-hidden="true">1.2.9.</strong> Custom</a></li></ol></li><li class="chapter-item expanded "><a href="carapace/invokedAction.html"><strong aria-hidden="true">1.3.</strong> InvokedAction</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="carapace/invokedAction/filter.html"><strong aria-hidden="true">1.3.1.</strong> Filter</a></li><li class="chapter-item expanded "><a href="carapace/invokedAction/merge.html"><strong aria-hidden="true">1.3.2.</strong> Merge</a></li><li class="chapter-item expanded "><a href="carapace/invokedAction/prefix.html"><strong aria-hidden="true">1.3.3.</strong> Prefix</a></li><li class="chapter-item expanded "><a href="carapace/invokedAction/suffix.html"><strong aria-hidden="true">1.3.4.</strong> Suffix</a></li><li class="chapter-item expanded "><a href="carapace/invokedAction/toA.html"><strong aria-hidden="true">1.3.5.</strong> ToA</a></li><li class="chapter-item expanded "><a href="carapace/invokedAction/toMultiPartsA.html"><strong aria-hidden="true">1.3.6.</strong> ToMultiPartsA</a></li></ol></li><li class="chapter-item expanded "><a href="carapace/batch.html"><strong aria-hidden="true">1.4.</strong> Batch</a></li><li class="chapter-item expanded "><a href="carapace/cache.html"><strong aria-hidden="true">1.5.</strong> Cache</a></li><li class="chapter-item expanded "><a href="carapace/standalone.html"><strong aria-hidden="true">1.6.</strong> Standalone</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="carapace/standalone/caraparse.html"><strong aria-hidden="true">1.6.1.</strong> caraparse</a></li><li class="chapter-item expanded "><a href="carapace/standalone/pflag.html"><strong aria-hidden="true">1.6.2.</strong> pflag</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="development.html"><strong aria-hidden="true">2.</strong> development</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="development/anatomyOfAShellCLI.html"><strong aria-hidden="true">2.1.</strong> Anatomy Of A shell CLI</a></li><li class="chapter-item expanded "><a href="development/additionalInformation.html"><strong aria-hidden="true">2.2.</strong> Additional Information</a></li><li class="chapter-item expanded "><a href="development/shells.html"><strong aria-hidden="true">2.3.</strong> Shells</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="development/shells/bash.html"><strong aria-hidden="true">2.3.1.</strong> Bash</a></li><li class="chapter-item expanded "><a href="development/shells/elvish.html"><strong aria-hidden="true">2.3.2.</strong> Elvish</a></li><li class="chapter-item expanded "><a href="development/shells/fish.html"><strong aria-hidden="true">2.3.3.</strong> Fish</a></li><li class="chapter-item expanded "><a href="development/shells/ion.html"><strong aria-hidden="true">2.3.4.</strong> Ion</a></li><li class="chapter-item expanded "><a href="development/shells/nushell.html"><strong aria-hidden="true">2.3.5.</strong> Nushell</a></li><li class="chapter-item expanded "><a href="development/shells/oil.html"><strong aria-hidden="true">2.3.6.</strong> Oil</a></li><li class="chapter-item expanded "><a href="development/shells/powershell.html"><strong aria-hidden="true">2.3.7.</strong> Powershell</a></li><li class="chapter-item expanded "><a href="development/shells/xonsh.html"><strong aria-hidden="true">2.3.8.</strong> Xonsh</a></li><li class="chapter-item expanded "><a href="development/shells/zsh.html"><strong aria-hidden="true">2.3.9.</strong> Zsh</a></li></ol></li><li class="chapter-item expanded "><a href="development/testing.html"><strong aria-hidden="true">2.4.</strong> Testing</a></li><li class="chapter-item expanded "><a href="development/uid.html"><strong aria-hidden="true">2.5.</strong> Uid</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">carapace</h1>

                    <div class="right-buttons">
                        
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#carapace" id="carapace">carapace</a></h1>
<p><a href="https://github.com/rsteube/carapace">carapace</a> is a command-line completion generator for <a href="https://github.com/spf13/cobra">spf13/cobra</a> with support for:</p>
<ul>
<li><a href="https://www.gnu.org/software/bash/">Bash</a></li>
<li><a href="https://elv.sh/">Elvish</a></li>
<li><a href="https://fishshell.com/">Fish</a></li>
<li><a href="https://doc.redox-os.org/ion-manual/html/">Ion</a> (<a href="https://github.com/rsteube/carapace/issues/88">experimental</a>)</li>
<li><a href="https://www.nushell.sh/">Nushell</a> (<a href="https://github.com/rsteube/carapace/issues/89">experimental</a>)</li>
<li><a href="http://www.oilshell.org/">Oil</a></li>
<li><a href="https://microsoft.com/powershell">Powershell</a></li>
<li><a href="https://xon.sh/">Xonsh</a></li>
<li><a href="https://www.zsh.org/">Zsh</a></li>
</ul>
<h1><a class="header" href="#gen" id="gen">Gen</a></h1>
<p>Calling <a href="https://pkg.go.dev/github.com/rsteube/carapace#Gen"><code>Gen</code></a> on the root command is sufficient to enable completion script generation using the <a href="carapace/./gen/hiddenSubcommand.html">hidden subcommand</a>.</p>
<pre><code class="language-go">import (
    &quot;github.com/rsteube/carapace&quot;
)

carapace.Gen(rootCmd)
</code></pre>
<p>Additionally invoke <a href="https://pkg.go.dev/github.com/rsteube/carapace#Test"><code>carapace.Test</code></a> in a <a href="https://golang.org/doc/tutorial/add-a-test">test</a> to verify configuration during build time.</p>
<pre><code class="language-go">func TestCarapace(t *testing.T) {
    carapace.Test(t)
}
</code></pre>
<h1><a class="header" href="#hidden-subcommand" id="hidden-subcommand">Hidden Subcommand</a></h1>
<p>When <a href="https://pkg.go.dev/github.com/rsteube/carapace#Gen"><code>Gen</code></a> is invoked a hidden subcommand (<code>_carapace</code>) is added. This handles completion script generation and <a href="carapace/gen/../action/actionCallback.html">callbacks</a>.</p>
<h2><a class="header" href="#completion" id="completion">Completion</a></h2>
<p><code>SHELL</code> is optional and will be detected by parent process name.</p>
<pre><code class="language-sh">command _carapace [SHELL]
</code></pre>
<pre><code class="language-sh"># bash
source &lt;(command _carapace)

# elvish
eval (command _carapace | slurp)

# fish
command _carapace | source

# oil
source &lt;(command _carapace)

# powershell
Set-PSReadlineKeyHandler -Key Tab -Function MenuComplete
command _carapace | Out-String | Invoke-Expression

# xonsh
COMPLETIONS_CONFIRM=True
exec($(command _carapace))

# zsh
source &lt;(command _carapace)
</code></pre>
<blockquote>
<p>Directly sourcing multiple completions in your shell init script increases startup time <a href="https://medium.com/@jzelinskie/please-dont-ship-binaries-with-shell-completion-as-commands-a8b1bcb8a0d0">considerably</a>. See <a href="https://github.com/rsteube/lazycomplete">lazycomplete</a> for a solution to this problem.</p>
</blockquote>
<h1><a class="header" href="#positionalcompletion" id="positionalcompletion">PositionalCompletion</a></h1>
<p><a href="https://pkg.go.dev/github.com/rsteube/carapace#Carapace.PositionalCompletion"><code>PositionalCompletion</code></a> defines completion for positional arguments using a list of <a href="carapace/gen/../action.html">actions</a>.</p>
<pre><code class="language-go">carapace.Gen(rootCmd).PositionalCompletion(
    carapace.ActionValues(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;),
    // ...
)
</code></pre>
<p><a href="https://pkg.go.dev/github.com/rsteube/carapace#Carapace.PositionalAnyCompletion"><code>PositionalAnyCompletion</code></a> defines completion for any positional argument not already defined.</p>
<pre><code class="language-go">carapace.Gen(rootCmd).PositionalAnyCompletion(
    carapace.ActionFiles(&quot;&quot;),
)
</code></pre>
<h1><a class="header" href="#flagcompletion" id="flagcompletion">FlagCompletion</a></h1>
<p><a href="https://pkg.go.dev/github.com/rsteube/carapace#Carapace.FlagCompletion"><code>FlagCompletion</code></a> defines completion for flags using a map consisting of name and <a href="carapace/gen/../action.html">action</a>.</p>
<pre><code class="language-go">carapace.Gen(myCmd).FlagCompletion(carapace.ActionMap{
    &quot;flagName&quot;: carapace.ActionValues(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;),
    // ...
})
</code></pre>
<h2><a class="header" href="#optional-argument" id="optional-argument">Optional argument</a></h2>
<p>To mark a flag argument as optional (<code>--name=value</code>) the <a href="https://pkg.go.dev/github.com/spf13/pflag#Flag"><code>NoOptDefVal</code></a> needs to be set to anything other than empty string.</p>
<pre><code class="language-go">rootCmd.Flag(&quot;optarg&quot;).NoOptDefVal = &quot; &quot;
</code></pre>
<h1><a class="header" href="#action" id="action">Action</a></h1>
<p>An <a href="https://pkg.go.dev/github.com/rsteube/carapace#Action"><code>Action</code></a> indicates how to complete a flag or a positional argument.</p>
<h1><a class="header" href="#actionvalues" id="actionvalues">ActionValues</a></h1>
<p><a href="https://pkg.go.dev/github.com/rsteube/carapace#ActionValues"><code>ActionValues</code></a> completes values.</p>
<pre><code class="language-go">carapace.ActionValues(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;)
</code></pre>
<h1><a class="header" href="#actionvaluesdescribed" id="actionvaluesdescribed">ActionValuesDescribed</a></h1>
<p><a href="https://pkg.go.dev/github.com/rsteube/carapace#ActionValuesDescribed"><code>ActionValuesDescribed</code></a> completes values with a description.</p>
<pre><code class="language-go">carapace.ActionValuesDescribed(
  &quot;a&quot;, &quot;description of a&quot;,
  &quot;b&quot;, &quot;description of b&quot;
)
</code></pre>
<h1><a class="header" href="#actionfiles" id="actionfiles">ActionFiles</a></h1>
<p><a href="https://pkg.go.dev/github.com/rsteube/carapace#ActionFiles"><code>ActionFiles</code></a> completes files with optional suffix filtering.</p>
<pre><code class="language-go">carapace.ActionFiles(&quot;.go&quot;, &quot;go.mod&quot;)
</code></pre>
<h1><a class="header" href="#actiondirectories" id="actiondirectories">ActionDirectories</a></h1>
<p><a href="https://pkg.go.dev/github.com/rsteube/carapace#ActionDirectories"><code>ActionDirectories</code></a> completes directories.</p>
<pre><code class="language-go">carapace.ActionDirectories()
</code></pre>
<h1><a class="header" href="#actionmessage" id="actionmessage">ActionMessage</a></h1>
<p><a href="https://pkg.go.dev/github.com/rsteube/carapace#ActionMessage"><code>ActionMessage</code></a> shows an error message.</p>
<pre><code class="language-go">carapace.ActionMessage(&quot;message example&quot;)
</code></pre>
<blockquote>
<p>To display the message <a href="carapace/action/./actionValuesDescribed.html">ActionValuesDescribed</a> is used with values <code>_</code>, <code>ERR</code> and the message as description.</p>
</blockquote>
<h1><a class="header" href="#actioncallback" id="actioncallback">ActionCallback</a></h1>
<p><a href="https://pkg.go.dev/github.com/rsteube/carapace#ActionCallback"><code>ActionCallback</code></a> is a special action where the program itself provides the completion dynamically. For this the <a href="carapace/action/../gen/hiddenSubcommand.html">hidden subcommand</a> is called with the current command line content which then lets cobra parse existing flags and invokes the callback function after that.</p>
<pre><code class="language-go">carapace.ActionCallback(func(c carapace.Context) carapace.Action {
  if conditionCmd.Flag(&quot;required&quot;).Value.String() == &quot;valid&quot; {
    return carapace.ActionValues(&quot;condition fulfilled&quot;)
  } else {
    return carapace.ActionMessage(&quot;flag --required must be set to valid: &quot; + conditionCmd.Flag(&quot;required&quot;).Value.String())
  }
})
</code></pre>
<ul>
<li><code>c.CallbackValue</code> provides access to the current (partial) value of the flag or positional argument being completed</li>
<li>return <a href="carapace/action/./actionValues.html">ActionValues</a> without arguments to silently skip completion</li>
<li>return <a href="carapace/action/./actionMessage.html">ActionMessage</a> to provide an error message (e.g. failure during invocation of an external command)</li>
<li><code>c.Args</code> provides access to the positional arguments of the current subcommand (excluding the one currently being completed)</li>
<li><a href="https://pkg.go.dev/github.com/rsteube/carapace#IsCallback"><code>IsCallback</code></a> indicates if the current invocation of the program is a callback (useful to skip any lengthy init steps)</li>
</ul>
<h1><a class="header" href="#actionmultiparts" id="actionmultiparts">ActionMultiParts</a></h1>
<p><a href="https://pkg.go.dev/github.com/rsteube/carapace#ActionMultiParts"><code>ActionMultiParts</code></a> is a <a href="carapace/action/./actionCallback.html">callback action</a> where parts of an argument can be completed separately (e.g. <code>user:group</code> from chown). Divider can be empty as well, but note that bash and fish will add the space suffix for anything other than <code>/=@:.,</code> (it still works, but after each selection backspace is needed to continue the completion).</p>
<pre><code class="language-go">carapace.ActionMultiParts(&quot;:&quot;, func(c carapace.Context) carapace.Action {
	switch len(parts) {
	case 0:
		return ActionUsers().Invoke(c).Suffix(&quot;:&quot;).ToA()
	case 1:
		return ActionGroups()
	default:
		return carapace.ActionValues()
	}
})
</code></pre>
<ul>
<li>values <strong>must not</strong> contain the separator as a simple <code>strings.Split()</code> is used to separate the parts</li>
<li>it is however <strong>allowed as suffix</strong> to enable fluent tab completion (like <code>/</code> for a directory)</li>
</ul>
<h2><a class="header" href="#nesting" id="nesting">Nesting</a></h2>
<p><a href="https://pkg.go.dev/github.com/rsteube/carapace#ActionMultiParts"><code>ActionMultiParts</code></a> can be nested as well, e.g. completing multiple <code>KEY=VALUE</code> pairs separated by <code>,</code>.</p>
<pre><code class="language-go">carapace.ActionMultiParts(&quot;,&quot;, func(cEntries carapace.Context) carapace.Action {
	return carapace.ActionMultiParts(&quot;=&quot;, func(c carapace.Context) carapace.Action {
		switch len(c.Parts) {
		case 0:
			keys := make([]string, len(cEntries.Parts))
			for index, entry := range cEntries.Parts {
				keys[index] = strings.Split(entry, &quot;=&quot;)[0]
			}
			return carapace.ActionValues(&quot;FILE&quot;, &quot;DIRECTORY&quot;, &quot;VALUE&quot;).Invoke(c).Filter(keys).Suffix(&quot;=&quot;).ToA()
		case 1:
			switch c.Parts[0] {
			case &quot;FILE&quot;:
				return carapace.ActionFiles(&quot;&quot;)
			case &quot;DIRECTORY&quot;:
				return carapace.ActionDirectories()
			case &quot;VALUE&quot;:
				return carapace.ActionValues(&quot;one&quot;, &quot;two&quot;, &quot;three&quot;)
			default:
				return carapace.ActionValues()

			}
		default:
			return carapace.ActionValues()
		}
	})
})
</code></pre>
<h1><a class="header" href="#actionexeccommand" id="actionexeccommand">ActionExecCommand</a></h1>
<p><a href="https://pkg.go.dev/github.com/rsteube/carapace#ActionExecCommand"><code>ActionExecCommand</code></a> executes given command and transforms its output using the provided function. If an error occurs during execution <a href="carapace/action/./actionMessage.html">ActionMessage</a> is returned instead with the first line of <code>stderr</code> or an exit code.</p>
<pre><code class="language-go">carapace.ActionExecCommand(&quot;git&quot;, &quot;remote&quot;)(func(output []byte) carapace.Action {
	lines := strings.Split(string(output), &quot;\n&quot;)
	return carapace.ActionValues(lines[:len(lines)-1]...)
})
</code></pre>
<h1><a class="header" href="#custom" id="custom">Custom</a></h1>
<p>Custom Actions can be created by using a function that returns <code>carapace.Action</code>. A range of these can be found at <a href="https://pkg.go.dev/github.com/rsteube/carapace-bin/pkg/actions">carapace-bin</a>.</p>
<pre><code class="language-go">type ExampleOpts struct {
	Static bool
}

//  ActionExample(ExampleOpts{Static: true})
func ActionExample(opts ExampleOpts) carapace.Action {
	return carapace.ActionCallback(func(c carapace.Context) carapace.Action {
		if opts.Static {
			return carapace.ActionValues(&quot;a&quot;, &quot;b&quot;)
		}
		if strings.HasPrefix(c.CallbackValue, &quot;file://&quot;) {
			return carapace.ActionFiles().Invoke(c).Prefix(&quot;file://&quot;).ToA()
		}
		return carapace.ActionValues()
	})
}
</code></pre>
<blockquote>
<p>Unless static values are returned the code should be wrapped in a <a href="carapace/action/./actionCallback.html">callback</a> or the code would be executed at program start (and slow it down considerably).
It is also mandatory when accessing the commands flag values as the callback function is invoked after these are parsed.</p>
</blockquote>
<h1><a class="header" href="#invokedaction" id="invokedaction">InvokedAction</a></h1>
<p><a href="https://pkg.go.dev/github.com/rsteube/carapace#InvokedAction"><code>InvokedAction</code></a> is a logical alias for an <a href="carapace/./action.html">Action</a> whose (nested) callback was <a href="https://pkg.go.dev/github.com/rsteube/carapace#Action.Invoke">invoked</a> and thus contains static values (essentially this is now an <a href="carapace/./action/actionValuesDescribed.html">ActionValuesDescribed</a>).</p>
<h1><a class="header" href="#filter" id="filter">Filter</a></h1>
<p><a href="https://pkg.go.dev/github.com/rsteube/carapace#InvokedAction.Filter"><code>Filter</code></a> filters values within an <a href="carapace/invokedAction/../invokedAction.html">InvokedAction</a>.
E.g. completing a unique list of values in an <a href="carapace/invokedAction/../action/actionMultiParts.html">ActionMultiParts</a>:</p>
<pre><code class="language-go">carapace.ActionMultiParts(&quot;,&quot;, func(c carapace.Context) carapace.Action {
 	return carapace.ActionValues(&quot;one&quot;, &quot;two&quot;, &quot;three&quot;).Invoke(c).Filter(c.Parts).ToA()
}
</code></pre>
<h1><a class="header" href="#merge" id="merge">Merge</a></h1>
<p><a href="https://pkg.go.dev/github.com/rsteube/carapace#InvokedAction.Merge"><code>Merge</code></a> combines values of multiple <a href="carapace/invokedAction/../invokedAction.html">InvokedActions</a>.</p>
<pre><code class="language-go">carapace.ActionValues(&quot;one&quot;, &quot;two&quot;).Invoke(c).Merge(carapace.ActionValues(&quot;three&quot;, &quot;four&quot;).Invoke(c)).ToA()
</code></pre>
<h1><a class="header" href="#prefix" id="prefix">Prefix</a></h1>
<p><a href="https://pkg.go.dev/github.com/rsteube/carapace#InvokedAction.Prefix"><code>Prefix</code></a> adds a prefix to all values within an <a href="carapace/invokedAction/../invokedAction.html">InvokedAction</a>.</p>
<pre><code class="language-go">carapace.ActionValues(&quot;melon&quot;, &quot;drop&quot;, &quot;fall&quot;).Invoke(c).Prefix(&quot;water&quot;).ToA()
</code></pre>
<h1><a class="header" href="#suffix" id="suffix">Suffix</a></h1>
<p><a href="https://pkg.go.dev/github.com/rsteube/carapace#InvokedAction.Suffix"><code>Suffix</code></a> adds a suffix to all values within an <a href="carapace/invokedAction/../invokedAction.html">InvokedAction</a>.</p>
<pre><code class="language-go">ActionUsers().Invoke(c).Suffix(&quot;:&quot;).ToA()
</code></pre>
<h1><a class="header" href="#toa" id="toa">ToA</a></h1>
<p><a href="https://pkg.go.dev/github.com/rsteube/carapace#InvokedAction.ToA"><code>ToA</code></a> casts an <a href="carapace/invokedAction/../invokedAction.html">InvokedAction</a> back to <a href="carapace/invokedAction/../action.html">Action</a>.</p>
<pre><code class="language-go">ActionValues().Invoke(c).ToA()
</code></pre>
<h1><a class="header" href="#tomultipartsa" id="tomultipartsa">ToMultiPartsA</a></h1>
<p><a href="https://pkg.go.dev/github.com/rsteube/carapace#InvokedAction.ToMultiPartsA"><code>ToMultiPartsA</code></a> creates an <a href="carapace/invokedAction/../action/actionMultiParts.html">ActionMultiParts</a> from values containing a specific separator.
E.g. completing the contents of a zip file (<code>dir/subdir/file</code>) by each path segment separately like <a href="carapace/invokedAction/../action/actionFiles.html">ActionFiles</a>:</p>
<pre><code class="language-go">func ActionZipFileContents(file string) carapace.Action {
	return carapace.ActionCallback(func(c carapace.Context) carapace.Action {
		if reader, err := zip.OpenReader(file); err != nil {
			return carapace.ActionMessage(err.Error())
		} else {
			defer reader.Close()
			vals := make([]string, len(reader.File))
			for index, f := range reader.File {
				vals[index] = f.Name
			}
			return carapace.ActionValues(vals...).Invoke(c).ToMultiPartsA(&quot;/&quot;)
		}
	})
}
</code></pre>
<h1><a class="header" href="#batch" id="batch">Batch</a></h1>
<p><a href="https://pkg.go.dev/github.com/rsteube/carapace#Batch"><code>Batch</code></a> bundles <a href="carapace/./action/actionCallback.html">callback actions</a> so they can be <a href="https://pkg.go.dev/github.com/rsteube/carapace#Action.Invoke">invoked</a> in parallel using goroutines.</p>
<pre><code class="language-go">carapace.ActionCallback(func(c carapace.Context) carapace.Action {
	return carapace.Batch(
		carapace.ActionValues(&quot;A&quot;, &quot;B&quot;),
		carapace.ActionValues(&quot;C&quot;, &quot;D&quot;),
		carapace.ActionValues(&quot;E&quot;, &quot;F&quot;),
	).Invoke(c).Merge().ToA()
})
</code></pre>
<h1><a class="header" href="#cache" id="cache">Cache</a></h1>
<blockquote>
<p>Cache is still <em>experimental</em> and will undergo some changes</p>
</blockquote>
<p><a href="https://pkg.go.dev/github.com/rsteube/carapace#Action.Cache"><code>Cache</code></a> provides a simple way to cache <a href="carapace/./action/actionCallback.html">callback actions</a>.
For this the values of an <a href="carapace/./invokedAction.html">InvokedAction</a> are persisted as <code>json</code> to <a href="https://pkg.go.dev/os#TempDir"><code>os.TempDir</code></a>:</p>
<pre><code class="language-handlebars">{{TempDir}}/carapace/{{username}}/{{binary}}/{{callerChecksum}}/{{cacheChecksum}}
</code></pre>
<table><thead><tr><th>ID</th><th>x</th><th>example</th></tr></thead><tbody>
<tr><td>TempDir</td><td>os.TempDir</td><td><code>/tmp</code></td></tr>
<tr><td>username</td><td>current user</td><td><code>root</code></td></tr>
<tr><td>binary</td><td>binary name</td><td><code>carapace</code></td></tr>
<tr><td>callerChecksum</td><td>sha1sum using <a href="https://pkg.go.dev/runtime#Caller"><code>runtime.Caller</code></a></td><td><code>89be88b670885d3d7855c7169ad7cfd2816a6c37</code></td></tr>
<tr><td>cacheChecksum</td><td>sh1sum of given <a href="https://pkg.go.dev/github.com/rsteube/carapace/pkg/cache#CacheKey"><code>CacheKeys</code></a></td><td><code>041858daaaa8b084122d4604a3223315c39edc3e</code></td></tr>
</tbody></table>
<h1><a class="header" href="#standalone" id="standalone">Standalone</a></h1>
<h1><a class="header" href="#caraparse" id="caraparse">caraparse</a></h1>
<p><a href="https://github.com/rsteube/carapace-bin/tree/master/cmd/caraparse">caraparse</a> is a helper tool that uses regex to parse gnu help pages. Due to strong inconsistencies between these the results may differ but generally give a good head start.</p>
<pre><code class="language-sh">docker node update --help | caraparse -n update -p node -s &quot;Update a node&quot;
</code></pre>
<h1><a class="header" href="#pflag" id="pflag">pflag</a></h1>
<h1><a class="header" href="#development" id="development">development</a></h1>
<blockquote>
<p>WIP</p>
</blockquote>
<h1><a class="header" href="#anatomy-of-a-shell-cli" id="anatomy-of-a-shell-cli">Anatomy of a shell CLI</a></h1>
<p>See <a href="https://en.wikipedia.org/wiki/Command-line_interface#Anatomy_of_a_shell_CLI">Anatomy_of_a_shell_CLI</a> for a detailed (and accurate) description.</p>
<h2><a class="header" href="#parameters" id="parameters">Parameters</a></h2>
<p>Generally a command accepts 0..n parameters:</p>
<pre><code class="language-sh">command param1 param2 param3 ... paramN
</code></pre>
<p>Parameters are separated by space which depending on shell can either be escaped (e.g. <code>arg\ with\ space</code>) or quoted (e.g. <code>&quot;arg with space&quot;</code>).</p>
<p>Everything else is just a commonly used logical classification of the parameters itself as defined by the command.</p>
<h2><a class="header" href="#positional-arguments" id="positional-arguments">Positional Arguments</a></h2>
<p>Any Parameter that is neither a flag, an argument for a flag or a subcommand is a positional argument.
While the order of flags and positional arguments can be mixed, the positional arguments must be after the (sub)command being executed.</p>
<pre><code class="language-sh">command subCommand1 subCommand2 arg1 --flag1 arg2 --flag2 flagArg1 arg3
</code></pre>
<h2><a class="header" href="#flags" id="flags">Flags</a></h2>
<p>Flags provide a predefined modification of a commands behaviour.
While positional arguments can only be provided once for the (sub)command being executed, flags can be set throughout the command structure.
Unless defined as <a href="https://github.com/spf13/cobra#persistent-flags">persistent</a> flags need to be set for the (sub)command where they are defined.</p>
<pre><code class="language-sh">command --flag1 subcommand1 --flag2 --persistentFlag1
</code></pre>
<p>Posix-style as supported by pflag:</p>
<table><thead><tr><th>type</th><th>example</th></tr></thead><tbody>
<tr><td>longhand flag</td><td><code>command --flag1</code></td></tr>
<tr><td>shorthand flag</td><td><code>command -f</code></td></tr>
<tr><td>longhand flag with argument</td><td><code>command --flag1 flagArg1</code></td></tr>
<tr><td>shorthand flag with argument</td><td><code>command -f flagArg1</code></td></tr>
<tr><td>longhand flag with optional argument</td><td><code>command --flag1=flagArg1</code></td></tr>
<tr><td>shorthand flag chain</td><td><code>command -abcdef flagArg1</code></td></tr>
</tbody></table>
<p>Other:</p>
<table><thead><tr><th>type</th><th>example</th></tr></thead><tbody>
<tr><td>long shorthand flag</td><td><code>command -flag1</code></td></tr>
<tr><td>dos/windows style</td><td><code>command /flag1</code></td></tr>
</tbody></table>
<h2><a class="header" href="#subcommand" id="subcommand">Subcommand</a></h2>
<pre><code class="language-sh">command subcommand1 --flag1 arg1 --flag2 flagArg1 arg2
command subcommand2 arg1 arg2
</code></pre>
<h1><a class="header" href="#additional-information" id="additional-information">Additional Information</a></h1>
<p>Additional information can be found at:</p>
<ul>
<li>Bash: <a href="https://iridakos.com/programming/2018/03/01/bash-programmable-completion-tutorial">bash-programmable-completion-tutorial</a> and <a href="https://www.gnu.org/software/bash/manual/html_node/Programmable-Completion-Builtins.html#Programmable-Completion-Builtins">Programmable-Completion-Builtins</a></li>
<li>Elvish: <a href="https://zzamboni.org/post/using-and-writing-completions-in-elvish/">using-and-writing-completions-in-elvish</a> and <a href="https://elv.sh/ref/edit.html#argument-completer">argument-completer</a></li>
<li>Fish: <a href="https://github.com/fish-shell/fish-shell/tree/master/share/functions">fish-shell/share/functions</a> and <a href="https://fishshell.com/docs/current/#writing-your-own-completions">writing your own completions</a></li>
<li>Powershell: <a href="https://adamtheautomator.com/powershell-parameters-argumentcompleter/">Dynamic Tab Completion</a> and <a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/register-argumentcompleter">Register-ArgumentCompleter</a></li>
<li>Xonsh: <a href="https://xon.sh/tutorial_completers.html">Programmable Tab-Completion</a> and <a href="https://github.com/xonsh/xonsh/blob/master/xonsh/completers/tools.py">RichCompletion(str)</a></li>
<li>Zsh: <a href="https://github.com/zsh-users/zsh-completions/blob/master/zsh-completions-howto.org#functions-for-performing-complex-completions-of-single-words">zsh-completions-howto</a> and <a href="http://zsh.sourceforge.net/Doc/Release/Completion-System.html#Completion-System">Completion-System</a>.</li>
</ul>
<h1><a class="header" href="#shells" id="shells">Shells</a></h1>
<h1><a class="header" href="#bash" id="bash">Bash</a></h1>
<table><thead><tr><th></th><th></th></tr></thead><tbody>
<tr><td>strings</td><td><code>''\'''</code> <code>&quot;\&quot;&quot;</code></td></tr>
<tr><td>escape characer</td><td><code>\</code></td></tr>
<tr><td>output capture</td><td><code>$()</code> `` <code>&lt;()</code></td></tr>
<tr><td>line continuation</td><td><code>\</code></td></tr>
<tr><td>brace expansion</td><td><code>{}</code></td></tr>
<tr><td>redirection</td><td><code>&lt;</code> <code>&gt;</code></td></tr>
</tbody></table>
<h1><a class="header" href="#elvish" id="elvish">Elvish</a></h1>
<table><thead><tr><th></th><th></th></tr></thead><tbody>
<tr><td>strings</td><td><code>''''</code> <code>&quot;\&quot;&quot;</code></td></tr>
<tr><td>escape characer</td><td>none</td></tr>
<tr><td>output capture</td><td><code>()</code></td></tr>
<tr><td>line continuation</td><td><code>^</code></td></tr>
<tr><td>brace expansion</td><td><code>{}</code></td></tr>
<tr><td>redirection</td><td><code>&lt;</code> <code>&gt;</code></td></tr>
</tbody></table>
<h1><a class="header" href="#fish" id="fish">Fish</a></h1>
<table><thead><tr><th></th><th></th></tr></thead><tbody>
<tr><td>strings</td><td><code>''</code> <code>&quot;&quot;</code></td></tr>
<tr><td>escape characer</td><td><code>\</code></td></tr>
<tr><td>output capture</td><td><code>()</code></td></tr>
<tr><td>line continuation</td><td><code>\</code></td></tr>
<tr><td>brace expansion</td><td><code>{}</code></td></tr>
<tr><td>redirection</td><td><code>&lt;</code> <code>&gt;</code></td></tr>
</tbody></table>
<h1><a class="header" href="#ion" id="ion">Ion</a></h1>
<h1><a class="header" href="#nushell" id="nushell">Nushell</a></h1>
<h1><a class="header" href="#oil" id="oil">Oil</a></h1>
<h1><a class="header" href="#powershell" id="powershell">Powershell</a></h1>
<h1><a class="header" href="#xonsh" id="xonsh">Xonsh</a></h1>
<h1><a class="header" href="#zsh" id="zsh">Zsh</a></h1>
<h1><a class="header" href="#testing" id="testing">Testing</a></h1>
<p>Since callbacks are simply invocations of the program they can be tested directly.</p>
<pre><code class="language-sh">example _carapace bash _ example condition --required ''
valid
invalid

example _carapace elvish _ example condition --required ''
[{&quot;Value&quot;:&quot;valid&quot;,&quot;Display&quot;:&quot;valid&quot;},{&quot;Value&quot;:&quot;invalid&quot;,&quot;Display&quot;:&quot;invalid&quot;}]

example _carapace fish _ example condition --required ''
valid
invalid

example _carapace powershell _ example condition --required ''
[{&quot;CompletionText&quot;:&quot;valid&quot;,&quot;ListItemText&quot;:&quot;valid&quot;,&quot;ToolTip&quot;:&quot; &quot;},{&quot;CompletionText&quot;:&quot;invalid&quot;,&quot;ListItemText&quot;:&quot;invalid&quot;,&quot;ToolTip&quot;:&quot; &quot;}]

example _carapace xonsh _ example condition --required ''
[{&quot;Value&quot;:&quot;valid&quot;,&quot;Display&quot;:&quot;valid&quot;,&quot;Description&quot;:&quot;&quot;},{&quot;Value&quot;:&quot;invalid&quot;,&quot;Display&quot;:&quot;invalid&quot;,&quot;Description&quot;:&quot;&quot;}]

example _carapace zsh _ example condition --required ''
valid   valid
invalid invalid
</code></pre>
<h1><a class="header" href="#uid" id="uid">Uid</a></h1>
<blockquote>
<p>deprecated</p>
</blockquote>
<p>Uids are generated to identify corresponding completions:</p>
<ul>
<li>positional arguments</li>
</ul>
<pre><code class="language-handlebars">_{{rootCmd}}__{{subCommand1}}__{{subCommand2}}#{{position}}
</code></pre>
<ul>
<li>flags</li>
</ul>
<pre><code class="language-handlebars">_{{rootCmd}}__{{subCommand1}}__{{subCommand2}}##{{flagName}}
</code></pre>
<ul>
<li>state</li>
</ul>
<pre><code class="language-handlebars">_{{rootCmd}}__{{subCommand1}}__{{subCommand2}}
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
        
        

    </body>
</html>
